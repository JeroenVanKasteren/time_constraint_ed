import os
from utils import tools, Simulation as Sim

FILEPATH_INSTANCE = 'results/'
FILEPATH_PICKLES = 'results/simulation_pickles/'
FILEPATH_RESULT = 'results/simulation_pickles/result_'

instance_names = [f for f in os.listdir(FILEPATH_INSTANCE)
                  if f.startswith('instance_sim_')]
continue_run = False
N = int(1e4)

# inst_to_sim = [instance_names[i - 1] for i in [3, 9, 10, 11, 12]]
# inst_to_sim = [instance_names[i - 1] for i in [1, 2, 3, 4]]
for instance_name in instance_names:
    inst = tools.inst_load(FILEPATH_INSTANCE + instance_name)
    methods = inst['method'].values
    for method in methods:
        simulation = Sim(inst=inst,
                         inst_id=instance_name[-6:-4],
                         method=method,
                         N=N)
        simulation.run(continue_run=continue_run)


# import utils
# from utils import TimeConstraintEDs as Env
# i = 0
# method, row_id, inst, pickle = utils.tools.load_result(i, inst_to_sim[0])
# print(pickle['kpi'])
# env = Env(J=inst.J[0], S=inst.S[0], gamma=inst.gamma[0], t=inst.t[0],
#           mu=inst.mu[0], lab=inst.lab[0], seed=int(inst_to_sim[0][-6:-4]),
#           sim='yes')
# arrival_times, service_times = tools.generate_times(env, N)
# for i in range(self.J):
#     print(self.arrival_times[i])
#     print(self.service_times[i])
#
# [76.51150681784864, 57.431555622055576, 96.79303299877344, 22.85213078633639, 222.95911449060162, 14.769779612665477, 100.51596251540576, 745.6695013171703, 59.368513406204734, 286.30440689609895, 114.93996257269602, 453.120108899403, 202.17882694162722, 330.73415189986144, 64.43734891632019, 39.587838117958164, 0.400835960011305, 259.5033988114738, 199.22813045403066, 270.9021455989826, 145.5840662216801, 127.99162649668264, 131.3760696593347, 130.0679792656764, 9.21063088304589, 480.4324709610402, 315.04349405585714, 14.607257328153171, 324.6371445082215, 681.9191167508426, 45.811408159694714, 172.559331177264, 28.527867348884662, 273.91631150782456, 473.84334590302007, 201.80553502049753, 301.8784889034382, 257.7616456515326, 168.87435937955752, 394.3057811894135, 86.59379784405854, 454.42825846293476, 989.0080468912156, 43.78755652324663, 530.0725606477467, 159.00989381112862, 115.1995320935528, 45.52332979351567, 696.9906969949216, 27.93614463563024, 326.5530066105295, 136.34526117910158, 560.6548926306982, 257.7835120963134, 947.6071392109776, 45.8179903961166, 41.57866679848503, 401.32480083601735, 97.73886411521525, 610.3589538395495, 247.77259428833702, 122.26918380646468, 753.3226353267952, 18.195747880809524, 243.13307523052842, 178.41440429447547, 17.38038416719114, 34.178804666418564, 28.600680243294207, 73.08903230447969, 69.2663830673567, 76.73557216508594, 126.49442894100906, 43.97627112961061, 542.1748294591644, 230.56988954484873, 378.31491380413365, 452.91649066439027, 19.096913897516384, 212.02879223002697, 214.27293619061294, 9.736529876280828, 747.9321131707516, 29.236510066086204, 206.50087077994195, 692.6569664103204, 97.4462046788046, 123.11948897259857, 363.9870541090942, 38.6142156267251, 168.13112340428273, 117.41672818928198, 323.81091169472694, 246.79670064896644, 178.52729075982563, 223.1530585675867, 14.075989193151514, 467.22933956954023, 134.66185254963042, 624.0005558188543, 252.86015158389006, 549.0326552974038, 665.8062581864709]
# [72.58273187453352, 26.885608710690775, 24.763504836381713, 33.58400554294968, 9.210377869794675, 125.49587251665537, 252.08796648102935, 7.8963477091214775, 274.24235378217156, 68.62998209873031, 55.56033288853082, 102.96243064882216, 246.59779832931406, 71.54998935092215, 28.20387201605109, 49.397193658724355, 72.59388890045433, 86.10328413222766, 11.129105610203139, 18.117876150672767, 119.67585169420134, 36.18110886451833, 19.458226036733866, 22.651345921523774, 56.00550531822456, 96.35453113576948, 10.612646946574127, 11.912366611004648, 236.73132265652004, 37.58117306394114, 74.49297897568518, 44.39327070065364, 28.3319191745177, 159.19798521289914, 18.47388149676812, 20.503977014081013, 27.012889471647583, 92.94321146105081, 62.73295152449122, 102.77187369811223, 64.84211284208357, 7.828592680091534, 5.823690958978752, 107.79888392061672, 23.5331236094887, 76.60908081260924, 65.00605460553656, 15.714101440993748, 75.63835837867896, 16.40445507155677, 119.07956908673052, 178.0028418404549, 74.49326364181184, 2.949730938860454, 7.246246696705173, 49.334813567897804, 61.95010183656572, 36.71918718866522, 82.35217966604466, 126.00582053745069, 28.20133580534416, 77.09751306024641, 22.942544293313926, 63.532745211998645, 83.21256913368555, 56.66974949259951, 31.828822868806917, 42.561637462249784, 5.483193931194684, 103.11759893062991, 105.86212209252477, 40.56518359789882, 74.35727697143862, 0.06397968685559786, 26.684601920842972, 132.49334967215202, 45.712387880189326, 47.008538564595035, 116.30871476162626, 227.93037775352224, 146.36851023482342, 79.80883698164776, 16.752154101557966, 61.89721875834971, 28.937489720380622, 208.12015877738298, 52.378941245503746, 127.81906402127785, 84.15059122940248, 4.464365543525978, 107.99044477163129, 101.0515805383552, 130.02759328245415, 70.48003069077888, 128.61174133510943, 53.2037245509565, 43.73853147340103, 7.678721381240561, 88.14360454536983, 122.1739559510457, 109.34052128897993, 17.572383926554703, 4.446112824378626]
#
# [130.44336396988524, 44.92291287071254, 45.834295823558584, 44.54901862451554, 36.75639322358079, 4.263381795982855, 79.49125685061463, 60.329147603084145, 213.39040351727203, 0.4122206369932914, 56.05812484590123, 9.89698976964571, 23.466073469195337, 31.075947646531805, 20.108479316413536, 87.23506252586174, 39.86027477908122, 43.51239419738216, 10.256335681263193, 40.68323375810886, 157.11060520782397, 98.07415425624016, 10.563845428886381, 23.317794580679635, 85.24943291181506, 13.429597949489757, 20.979107096852573, 31.169394726743008, 22.724399117541978, 13.022637182838487, 101.7255620688008, 22.486495154064123, 50.4895846698027, 5.283339174172344, 112.30166613962095, 125.03100649858665, 79.63768314210695, 30.084422596280408, 24.004979139447787, 105.7998841757799, 13.972894151674538, 3.765560893180802, 0.2573080214704409, 128.3159129998581, 153.88334590594843, 10.011931335987686, 11.994174704231355, 1.9781552640355768, 59.93208090231072, 40.92717982596374, 126.29604311283698, 9.547995189228523, 13.346054817832414, 28.089880085702976, 50.90400802948695, 11.102592886426812, 138.6364088874806, 20.892374350710938, 55.31294759455839, 29.946183468351496, 24.11838287877388, 73.17514352965947, 47.731190300745396, 131.26821747766047, 1.951231906259262, 57.61680721558668, 27.769924204999604, 7.31976867365085, 15.865584942525171, 67.06857606817375, 52.098235165189166, 16.01695652275996, 37.73046636701397, 52.86371757796595, 16.633338805569828, 160.98454406041014, 0.2867228589067896, 17.41630509403254, 49.59961824604973, 39.53272118680061, 33.880295322243185, 203.7644915784766, 54.892091034726256, 151.2857431649188, 55.306322373572215, 19.77430077971691, 6.5504009963254575, 137.94145182611487, 34.948829676869494, 38.08890729527636, 16.11895662311007, 4.846969181031945, 29.74394036458063, 34.46961121068897, 16.58760689590736, 3.0103920771188704, 56.57508563052215, 12.465562238562493, 91.50633455660741, 3.973306960591383, 54.08071379318963, 4.839110184674465, 99.98722736744972]
# [0.05713577840766823, 22.900082160412286, 67.41825795696847, 25.080949367291147, 95.69852771059315, 2.508594413606444, 30.388835467333262, 78.32975170493805, 0.5306286212771527, 31.033187388632474, 16.615027465834785, 21.127471773306304, 33.44879401743162, 229.72805240925007, 7.596160661649504, 32.3642961077254, 34.276241336309745, 22.9117061752778, 156.44435555704158, 37.563811144045594, 50.36103882125756, 44.89596103445903, 30.85854541749053, 43.8851813765471, 1.8757248880116548, 31.643906061074905, 34.07235193281004, 8.331544893525942, 42.829321569551226, 9.984077975828855, 215.82782229680652, 47.20505543223995, 2.7164034481621147, 6.619886470520979, 26.02265567155681, 55.49743887295172, 221.78272079085355, 153.128046584152, 82.07290616524686, 7.820298610584143, 40.359237812422215, 59.06610425646207, 40.62966784166736, 80.70070230152157, 35.34326558064017, 139.03349068595287, 57.33979014665267, 38.340666163199586, 97.4463930847373, 25.359020220326013, 222.8220580474934, 12.070848545739945, 9.218736233764925, 51.71833712439943, 82.61919953120648, 26.644938510859742, 24.660061777026, 149.21651349841585, 1.2278977867883731, 8.876221719268369, 164.27939811732173, 132.51460900132682, 37.96648986640717, 16.12053660053481, 61.14029334623896, 86.27140131520173, 23.87772328074604, 80.98601463837727, 44.37541548974656, 167.07262913052523, 24.009798686410793, 2.022873807340474, 7.838401963435592, 15.841531923093351, 44.106927315998476, 34.192623143817414, 38.51238887391687, 17.521969067621214, 3.05745432663453, 17.164898641761155, 60.59847946255395, 13.996009191255053, 30.976710617559277, 22.398626419395647, 17.99240056214323, 50.8103571841341, 23.69970181058647, 43.8777985164829, 87.74137685066182, 73.07554625198095, 15.578987366790933, 30.339186359860513, 39.25988609394491, 119.0594318313733, 67.07252643899291, 105.4406947617776, 79.3235080091478, 165.50085470797433, 39.07083535332447, 38.8353815623116, 3.646332627729157, 7.255823248766293, 2.7261988316756964]
#
# [1.0883898212795171, 31.59452649403131, 4.291361128926024, 10.0504818403614, 18.769358389796846, 9.00716223424268, 1.4420240780273883, 11.968564011803034, 34.4312455504965, 13.483918255992183, 14.367404832655073, 25.171375612588108, 30.62757532542518, 54.34117682603382, 3.0483100795306957, 13.106758668657458, 16.476283689574537, 15.55971295072558, 32.152807242237245, 34.25577699398493, 35.36836888525736, 109.39773976568503, 0.9047588464355127, 10.883663566005431, 1.0443215363598695, 16.179344340646523, 81.14019162346582, 14.367855036731834, 4.915577490076352, 3.285347622878041, 33.526556215090665, 21.59251103650601, 54.29967223718512, 61.9864717235845, 3.7718700133311933, 3.445502451007804, 78.49524370240745, 0.32938524798045343, 11.78436937962201, 18.665769627254402, 31.11512998490855, 53.204962708666145, 1.2821977331811991, 10.461064327766364, 7.298093972913613, 8.582141731511069, 9.219177522572906, 0.08148401560690545, 4.759284916552926, 25.730863220915595, 4.473163079912809, 42.37896310075389, 74.06575972676299, 11.421588494083958, 8.48546891850966, 55.80661976004246, 8.888786691127274, 24.028652706216292, 8.291684617491743, 25.768894990909107, 52.58667419812355, 60.1313879245216, 39.222305847376944, 30.567335268122953, 22.917150836546288, 6.787262799500576, 8.284595446774333, 10.181729886441785, 10.945451943682723, 48.20121441859444, 4.757851792235377, 66.37798183630228, 6.293594800146487, 17.988434201733902, 39.32912719001482, 35.27953334203044, 8.2444867628236, 19.88731524996298, 34.38714980041504, 17.562723180855436, 33.275485594538715, 1.2686000834448914, 4.045812809365938, 2.4203415390352223, 1.5908295131193826, 31.91606056647334, 66.03425469177, 33.22748473499093, 4.890649407196507, 8.899464129550886, 38.78883623884604, 24.136023234193114, 0.8541123231422524, 19.467627454753213, 39.276692896962295, 3.4856339623883175, 18.807498971649693, 10.85800553797052, 5.724020836772103, 33.80176068908071, 12.443900286307857, 9.25646295942037, 3.429249515239449]
# [24.7160135923858, 1.2262640743205406, 29.42225205009545, 28.00596908113478, 0.5560951255849103, 70.51683516235306, 19.552525107090545, 0.9519445919440712, 114.64809136291962, 63.5962356203202, 149.84234605131275, 110.40696944399593, 29.801649021817443, 1.2841882386344798, 186.6787896323511, 10.57952541349684, 0.8295536654128056, 75.4364782414035, 10.065973029425226, 86.12830178525327, 44.03565232051312, 51.73379826705644, 129.9788380635051, 101.94436266320382, 43.75975025195931, 168.25202716852212, 106.43830300238766, 16.083624058733545, 12.1891117834539, 34.589564528374865, 51.94720571436518, 4.54291046840473, 39.54538257332487, 33.96680536886075, 40.99407936765962, 20.915472046280893, 7.084757276628775, 143.42858357013034, 87.11031087644182, 57.71789144091764, 89.52137975866883, 28.590633176376944, 3.0034460804114747, 78.68170168818126, 14.82773029033548, 19.913174002127942, 42.72843981869209, 344.40876555471124, 18.473383130104796, 44.689758115007024, 131.25842913443225, 79.1748962619415, 25.627499671606934, 13.392668376340133, 65.1118054858664, 5.293108539852221, 29.07868858185993, 9.785003692549374, 29.960698757707053, 26.11611492119898, 15.283052846452847, 3.17286451728974, 73.67416039268981, 109.38944363508209, 155.6841592220071, 20.786619820307596, 92.0811902382118, 15.401439389399624, 10.383901324764727, 122.89860511378369, 95.23072843447703, 85.4179345347599, 33.41693311280372, 72.47903459473373, 96.52421452464473, 92.49625468226205, 31.1118082705461, 12.780143663157597, 62.17269869108287, 8.43738870162385, 28.565294673183146, 20.282598175522587, 115.45768226542323, 1.1402981518867858, 0.2613925592617018, 43.549062072548345, 32.722050551613975, 43.50942521078312, 51.91398197817368, 71.04434781882155, 44.037528553957955, 3.3599377969324626, 97.82463382115921, 135.48077709000393, 91.83461587841477, 132.9720441447556, 47.483643738930205, 0.7176441733574496, 31.918350209823625, 17.075299584924508, 99.52239411202903, 24.93226591779408, 68.90390210240547]
